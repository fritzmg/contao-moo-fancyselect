/*
---
description: A non-obtrusive image dropdown menu that extends and replaces a standard HTML Select control. 

license: MIT-style

authors:
- Lorenzo Stanco

requires:
- core/1.4.1: '*'

provides: [FancySelect]

...
*/
var FancySelect=new Class({Implements:[Options,Events],options:{legacyEvents:false,showText:true,showImages:true,className:"fancy-select",offset:{x:0,y:0},autoHide:false,autoScrollWindow:false,animateFade:true,animateSlide:true,fx:{duration:"short"},relativeTo:document.body},initialize:function(e,t){this.setOptions(t);this.options.animateSlide=false;this.element=document.id(e);this.element.store("fancyselect_object",this);this._create();this.attach();if(this.options.autoScrollWindow)this.addEvent("show",function(){var e=window.getScroll();var t=this.ul.getPosition().y+this.ul.getSize().y-window.getSize().y-e.y;if(t>0)window.scrollTo(e.x,e.y+t+10)});if(this.options.autoHide)document.addEvent("click",function(e){if(!this.shown)return;var t=document.id(e.target);var n=t.getParents().include(t);if(!n.contains(this.ul)&&!n.contains(this.div))this.hide()}.bind(this));return this},attach:function(){this.element.setStyle("display","none");this.select(this.element.get("value"));if(Browser.ie)window.addEvent("load",function(){this.select(this.element.get("value"))}.bind(this));this.ul.fade("hide").inject(document.id(document.body));this.div.inject(this.element,"after");this.attached=true;this.fireEvent("attach");return this},detach:function(){if(this.ul)this.ul.dispose();if(this.div)this.div.dispose();this.element.setStyle("display","");this.attached=false;this.fireEvent("detach");return this},select:function(e){if(this.element.get("value")!=e){this.element.set("value",e);if(this.options.legacyEvents){this.element.fireEvent("change");this.element.getParents().fireEvent("change")}}var t="v"+e;if(this.options.showText)this.div.getElement("span.text").set("text",this.selectOptions[t].text);if(this.options.showImages)this.div.getElement("img.image").setProperties({src:this.selectOptions[t].image,alt:this.selectOptions[t].alt});if(this.ul){this.ul.getElements("li").each(function(t){if(t.getProperty("data-value")==e)t.addClass("selected");else t.removeClass("selected")})}return this},update:function(){var e=this.attached;this.detach();this._create();if(e)this.attach();return this},show:function(){var e=this.options.offset;var t=this.div.getCoordinates(this.options.relativeTo);this.ul.setStyles({top:t.top+t.height+e.y,left:t.left+e.x});this._animate(false);this.shown=true;this.fireEvent("show");return this},hide:function(){this._animate(true);this.shown=false;this.fireEvent("hide");return this},toggle:function(){if(this.shown)return this.hide();else return this.show()},_create:function(){var e=this.options;if(this.ul)this.ul.destroy();if(this.div)this.div.destroy();this.selectOptions={};this.element.getElements("option").each(function(t){var n=t.getProperty("value");var r="v"+n;this.selectOptions[r]={};if(t.get("disabled"))this.selectOptions[r].disabled=true;if(e.showText)this.selectOptions[r].text=t.get("text");if(e.showImages){this.selectOptions[r].image=t.getProperty("data-image");this.selectOptions[r].alt=t.getProperty("data-alt")}}.bind(this));this.ul=(new Element("ul")).addClass(e.className);Object.each(this.selectOptions,function(t,n){var r=new Element("li",{"data-value":n.substr(1)});if(t.disabled)r.addClass("disabled");if(e.showImages&&t.image)r.adopt(new Element("img.image",{src:t.image,alt:t.alt}));if(e.showText&&t.text)r.adopt(new Element("span.text",{text:t.text}));r.addEvent("click",function(){if(r.hasClass("disabled"))return;this.select(r.getProperty("data-value"));this.hide()}.bind(this));this.ul.adopt(r)}.bind(this));this.ul.setStyles({position:"absolute",top:0,left:0});if(e.animateFade)this.ul.set("tween",e.fx);if(e.animateSlide)this.ul.set("slide",e.fx);this.div=(new Element("div")).addClass(e.className);if(e.showImages)this.div.adopt(new Element("img.image"));if(e.showText)this.div.adopt(new Element("span.text"));this.div.adopt(new Element("span.arrow"));this.div.addEvent("click",function(){this.toggle()}.bind(this));return this},_animate:function(e){var t=this.options;if(t.animateFade)this.ul.fade(e?"out":"in");if(t.animateSlide)this.ul.slide(e?"out":"in");if(!t.animateFade&&!t.animateSlide)this.ul.fade(e?"hide":"show");return this}});Elements.implement({fancySelect:function(e){this.each(function(t){new FancySelect(t,e)});return this}});Element.implement({fancySelect:function(e){new FancySelect(document.id(this),e);return this},fancySelectShow:function(){var e=this.retrieve("fancyselect_object");if(e)e.show(this);return this},fancySelectHide:function(){var e=this.retrieve("fancyselect_object");if(e)e.hide(this);return this},fancySelectToggle:function(){var e=this.retrieve("fancyselect_object");if(e)e.toggle(this);return this}});Element.Properties.fancySelect={get:function(){return this.retrieve("fancyselect_object")}}